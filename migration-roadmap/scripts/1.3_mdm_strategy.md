## Master Data Management (MDM) Strategy Document

### 1. Golden Record Entities

#### 1.1 Item Master (INVMAST)
**Source Systems:** INV002 (authoritative), WMS001 (location/qty), POS003 (pricing)  
**Golden Record Fields:**
- **Business Key:** ITEM_SKU (14-char, immutable once assigned)
- **Descriptive:** ITEM_DESC, CATEGORY_CODE, SUBCATEGORY_CODE, BRAND_NAME
- **Physical:** WEIGHT_LBS, LENGTH_IN, WIDTH_IN, HEIGHT_IN
- **Commercial:** COST_USD (from PURCH005), RETAIL_USD (from PRICE013)
- **Operational:** ACTIVE_FLG, HAZMAT_FLG, PERISHABLE_FLG
- **Lineage:** CREATE_DATE, LAST_MODIFIED_TS, DATA_SOURCE

**Survivorship Rules:**
1. ITEM_DESC: INV002 wins (merchandising authority)
2. COST_USD: PURCH005 wins (most recent PO receipt)
3. RETAIL_USD: PRICE013 wins (pricing team authority)
4. WEIGHT/DIMENSIONS: WMS001 wins if populated (operational measurement), else INV002
5. ACTIVE_FLG: INV002 wins unless PURCH005 marks as discontinued

**Match Algorithm:**
- Primary: Exact match on ITEM_SKU
- Secondary: Fuzzy match on UPC_CODE (Levenshtein distance <= 2)
- Tertiary: Manual review if ITEM_DESC + VENDOR_ID + BRAND_NAME similarity > 85%

**GCP Implementation:**
- BigQuery table: `mdm_prod.item_master_golden`
- Dataflow job: Daily merge from source tables
- DLP API: Mask cost data for non-finance users
- Audit: All changes logged to `mdm_audit.item_master_history`

---

#### 1.2 Vendor Master (VENDMAST)
**Source Systems:** PURCH005 (authoritative), EDI024 (trading partner IDs)  
**Golden Record Fields:**
- **Business Key:** VENDOR_ID (integer, auto-increment)
- **Identification:** VENDOR_NAME, TAX_ID, DUNS_NUMBER, GLN_CODE
- **Contact:** ADDR_LINE1-4, CITY, STATE, ZIP, COUNTRY, PHONE, EMAIL
- **Terms:** PAYMENT_TERMS, DISCOUNT_PCT, CURRENCY_CODE, BANK_ACCOUNT
- **Operational:** ACTIVE_FLG, PREFERRED_VENDOR_FLG, EDI_CAPABLE_FLG

**Survivorship Rules:**
1. VENDOR_NAME: PURCH005 wins (AP team maintains legal names)
2. TAX_ID: PURCH005 wins (validated against IRS)
3. PAYMENT_TERMS: PURCH005 wins (contract authority)
4. EDI_CAPABLE_FLG: EDI024 wins (technical capability)

**Match Algorithm:**
- Primary: Exact match on VENDOR_ID or TAX_ID
- Secondary: Fuzzy match on VENDOR_NAME + ZIP (Soundex + Jaro-Winkler > 0.90)
- Tertiary: DUNS_NUMBER lookup via D&B API

**GCP Implementation:**
- Cloud SQL (PostgreSQL): `mdm.vendor_master_golden`
- Deduplication: Cloud Function triggered on INSERT/UPDATE
- External enrichment: Cloud Scheduler → D&B API → update DUNS/credit rating

---

#### 1.3 Member Master (MBRMAST)
**Source Systems:** MEMBER006 (authoritative), POS003 (purchase history), LOYALTY021 (rewards)  
**Golden Record Fields:**
- **Business Key:** MEMBER_NUM (integer, immutable)
- **Personal:** FIRST_NAME, LAST_NAME, EMAIL, PHONE, DATE_OF_BIRTH
- **Address:** PRIMARY_ADDR (struct), MAILING_ADDR (struct)
- **Membership:** MEMBERSHIP_TYPE, EXPIRATION_DATE, RENEWAL_COUNT, STATUS_CODE
- **Behavioral:** LIFETIME_SPEND_USD, LAST_PURCHASE_DATE, LOYALTY_POINTS
- **Privacy:** MARKETING_OPT_IN, EMAIL_OPT_IN, SMS_OPT_IN, GDPR_CONSENT_DATE

**Survivorship Rules:**
1. EMAIL/PHONE: MEMBER006 wins (member self-service portal is source)
2. ADDRESS: MEMBER006 wins unless flagged undeliverable, then POS003 (recent transaction addr)
3. LIFETIME_SPEND: Calculated from POS003.POSSALE (not stored in MEMBER006)
4. LOYALTY_POINTS: LOYALTY021 wins (real-time accrual/redemption)

**Match Algorithm:**
- Primary: Exact match on MEMBER_NUM
- Secondary: EMAIL (case-insensitive) or PHONE (E.164 normalized)
- Tertiary: FIRST_NAME + LAST_NAME + ZIP + DOB (manual review if 4/4 match)

**GCP Implementation:**
- BigQuery table: `mdm_prod.member_master_golden`
- PII encryption: Cloud KMS (CMEK), DLP API for masking
- GDPR compliance: Deletion pipeline via Pub/Sub → Cloud Function → secure-delete all shards

---

#### 1.4 Warehouse Master (Synthetic - inferred from WHLOC)
**Source Systems:** WMS001 (WHLOC physical layout), SHIP004 (address/carrier mapping)  
**Golden Record Fields:**
- **Business Key:** WAREHOUSE_ID (4-char, e.g., "W001")
- **Descriptive:** WAREHOUSE_NAME, WAREHOUSE_TYPE (Regional/Hub/Depot)
- **Address:** STREET_ADDR, CITY, STATE, ZIP, COUNTRY, LATITUDE, LONGITUDE
- **Capacity:** TOTAL_SQ_FT, PALLET_POSITIONS, TEMP_CONTROLLED_FLG
- **Operational:** OPERATING_HOURS, MANAGER_ID, PHONE, STATUS_CODE

**Survivorship Rules:**
1. ADDRESS: SHIP004 wins (shipping compliance requires validated addresses)
2. CAPACITY: WMS001 wins (warehouse operations measured data)

**Match Algorithm:**
- Primary: Exact match on WAREHOUSE_ID
- Secondary: WAREHOUSE_NAME + CITY (fuzzy match > 0.95)

**GCP Implementation:**
- Cloud SQL (PostgreSQL): `mdm.warehouse_master` (small table, <1000 rows)
- Geocoding: Google Maps Platform API for LATITUDE/LONGITUDE

---

### 2. Data Stewardship Model

| Entity | Create Authority | Update Authority | Approval Required | SLA (hours) |
|--------|------------------|------------------|-------------------|-------------|
| Item Master | Merchandising Team | Merchandising + Pricing | Manager approval for ACTIVE_FLG=N | 4 |
| Vendor Master | Procurement Team | AP Team | Controller approval for new vendors | 24 |
| Member Master | Member Services (self-service) | Member Services + IT | None (self-service) | 1 |
| Warehouse Master | Operations VP | Warehouse Manager | VP approval for new warehouses | 48 |
| Location Master | Warehouse Manager | WMS operators | None (operational) | 0.5 |

**GCP IAM Mapping:**
- Merchandising Team: `roles/bigquery.dataEditor` on `mdm_prod.item_master_*`
- Procurement Team: `roles/cloudsql.client` on `mdm.vendor_master_golden`
- AP Team: `roles/cloudsql.editor` with row-level security filter
- Member Services: `roles/bigquery.dataViewer` + custom role for PII access (break-glass)

---

### 3. Conflict Resolution & Survivorship

**Precedence Hierarchy (when multiple sources have conflicting data):**
1. **Manual Override** (data steward correction in MDM UI) - highest precedence
2. **Most Recent Transaction** (temporal authority - e.g., POS003 for last purchase date)
3. **Designated Source of Truth** (per entity/field - see survivorship rules above)
4. **Least NULL Strategy** (for optional fields, prefer source with populated value)
5. **Default Value** (last resort - e.g., UNKNOWN_VENDOR if all sources NULL)

**Conflict Logging:**
- All conflicts written to `mdm_audit.conflict_log` with:
  - Entity type, business key, field name
  - Source A value, Source B value, winning value, reason code
  - Steward_user_id (if manual resolution), timestamp
- Monthly report to Data Governance Council

---

### 4. Data Lineage & Observability

**Lineage Tracking (Apache Atlas / Dataplex integration):**
- Source system → GCS staging → Dataflow transformation → BigQuery/Cloud SQL MDM table
- Column-level lineage for audit (e.g., ITEM.COST_USD ← PURCH005.PORECV.UNIT_COST)

**Data Quality Monitoring (Cloud Monitoring + custom metrics):**
- Freshness: Alert if MDM table not updated in > 6 hours
- Completeness: Alert if NULL rate for critical fields > 5%
- Consistency: Alert if ITEM_SKU in POS003 not found in MDM (orphaned foreign key)
- Anomaly detection: Alert if daily record count delta > 3 std dev from 30-day avg

---

### 5. Migration Phasing for MDM

**Phase 1 (Months 1-2): Pilot on Item Master**
- Scope: 100,000 highest-velocity SKUs (80% of revenue)
- Dual-write: AS400 remains authoritative, GCP MDM is read-only replica
- Validation: Daily reconciliation report (record count, checksum, sample comparison)

**Phase 2 (Months 3-4): Expand to Vendor + Member Master**
- Scope: All vendors, all active members
- Dual-write continues
- Introduce MDM UI (Cloud Run app) for data stewards to flag/resolve conflicts

**Phase 3 (Months 5-6): Flip to GCP as Source of Truth**
- AS400 becomes read-only for MDM entities
- Reverse ETL: GCP MDM → AS400 nightly sync (until full app migration)
- Rollback plan: Restore AS400 as SOT if critical issues detected

**Phase 4 (Months 7+): Retire AS400 MDM Tables**
- Once all dependent apps migrated to GCP
- Archive AS400 MDM tables to GCS for compliance (7-year retention)